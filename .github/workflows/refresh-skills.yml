name: Refresh Expert Skills

on:
  schedule:
    # Every Monday at 9am UTC
    - cron: '0 9 * * 1'
  workflow_dispatch: # Allow manual trigger

jobs:
  refresh-base-ui:
    name: Refresh Base UI Expert
    runs-on: ubuntu-latest

    steps:
      - name: Launch Cursor cloud agent
        run: |
          RESPONSE=$(curl --silent --request POST \
            --url https://api.cursor.com/v0/agents \
            --header "Authorization: Bearer ${{ secrets.CURSOR_API_KEY }}" \
            --header "Content-Type: application/json" \
            --data @- <<'EOF'
          {
            "prompt": {
              "text": "You are the Base UI expert agent for the Origin design system. Your job is to maintain a comprehensive, living knowledge base about @base-ui/react so that any agent building Origin components has full expert knowledge without reading upstream docs.\n\n## Step 1: Fetch ALL upstream documentation\n\nStart with https://base-ui.com/llms.txt to get the full sitemap. Then fetch EVERY page listed:\n\n### Handbook pages (fetch all):\n- https://base-ui.com/react/handbook/styling.md\n- https://base-ui.com/react/handbook/animation.md\n- https://base-ui.com/react/handbook/composition.md\n- https://base-ui.com/react/handbook/customization.md\n- https://base-ui.com/react/handbook/forms.md\n- https://base-ui.com/react/handbook/typescript.md\n\n### Component pages (fetch all ~35):\nEvery component URL listed under '## Components' in llms.txt. Each page contains API reference, usage guidelines, examples (CSS Modules + Tailwind), accessibility notes, and anatomy.\n\n### Releases:\n- https://base-ui.com/react/overview/releases.md\n\n## Step 2: Read the current skill files\n\n- .cursor/skills/base-ui-expert/SKILL.md\n- .cursor/skills/base-ui-expert/reference.md\n\nCheck the 'Auto-refreshed' date in SKILL.md to see when it was last updated.\n\n## Step 3: Scan Origin's actual usage\n\nSearch src/components/ for all `from '@base-ui/react/` imports to build the real map of which Base UI primitives Origin wraps.\n\n## Step 4: Update the skill files\n\n### SKILL.md (under 250 lines) should contain:\n- Current version and date\n- Component availability table (Base UI primitive -> Origin uses it?)\n- Core patterns: wrapping, render prop, data attributes, Field integration, animation\n- Known quirks specific to how Origin uses Base UI (e.g., the textarea ref cast)\n- Recent changelog highlights\n\n### reference.md (detailed, can be longer) should contain:\n- Every component's full API: import path, parts, key props with types, data attributes, render defaults\n- Usage guidelines and accessibility notes extracted from the docs\n- CSS Modules examples from the docs (Origin uses SCSS Modules, so these are directly relevant)\n- Composition patterns with real code examples from the handbook\n- Form integration patterns from the forms handbook\n- Animation patterns from the animation handbook\n- TypeScript patterns from the TypeScript handbook\n- Breaking change history from beta through stable\n- Gotchas, edge cases, and recommendations mentioned in component docs\n\n### If new components were added upstream:\n- Add them to the availability table\n- Add full API docs to reference.md\n- Note if Origin should consider wrapping them\n\n### If breaking changes affect Origin:\n- Flag them prominently in the PR description\n- Add a 'Migration needed' section to SKILL.md\n\n## Step 5: Commit and PR\n\nIf anything changed:\n1. Update the 'Auto-refreshed' date in SKILL.md\n2. Commit with message 'skill: refresh Base UI expert (vX.Y.Z)'\n3. Push to branch 'skill/base-ui-YYYYMMDD'\n4. Open a PR with a summary of what changed upstream\n\nIf nothing changed upstream, do nothing.\n\n## Rules\n- Do NOT modify any Origin component code. Only update skill files.\n- Do NOT add emojis.\n- Distill documentation into actionable knowledge. Don't just copy-paste â€” synthesize it so an agent can use it efficiently.\n- Every example should be relevant to how Origin uses Base UI (SCSS Modules, forwardRef wrappers, compound components).\n- Focus on what an agent needs to know to BUILD correctly, not just what exists."
            },
            "model": "claude-4-opus-thinking",
            "source": {
              "repository": "https://github.com/lightsparkdev/origin",
              "ref": "main"
            }
          }
          EOF
          )

          echo "Agent response: $RESPONSE"

          # Extract agent ID for tracking
          AGENT_ID=$(echo "$RESPONSE" | jq -r '.id // .agentId // "unknown"')
          echo "Agent ID: $AGENT_ID"
          echo "Track at: https://cursor.com/agents"
