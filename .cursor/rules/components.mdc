---
description: Rules for implementing components from Figma designs
globs:
  - src/components/**/*.tsx
  - src/components/**/*.scss
---

# Component Implementation

## Figma Tooling

| Tool | Reliability | Use Case |
|------|-------------|----------|
| MCP `get_screenshot` | 100% | Visual verification |
| MCP `get_metadata` | 100% | Structure/node IDs |
| MCP `get_design_context` | ~70% | CSS extraction (may timeout) |
| `npm run figma:node` | 100% | CSS fallback when MCP times out |
| `npm run figma:styles` | 100% | Text/effect token sync |

**Strategy**: MCP first, REST API as fallback for CSS.

## Sources

| Source | Purpose |
|--------|---------|
| Figma MCP / REST API | CSS properties |
| Base UI docs | API, accessibility |
| `_variables.scss` | Tokens |
| `_text-styles.scss` | Typography mixins |
| `_effects.scss` | Shadows |

## Rules

1. Fetch Figma CSS before writing styles (MCP or fallback)
2. Use tokens where they exist; raw values where they don't (don't invent tokens)
3. Use `clsx` for className merging
4. Use `forwardRef` on DOM components (not Root/Portal)
5. Use `render` prop for composition
6. Pass through Base UI props directly (don't create abstractions like `type` over `multiple`)
7. Include Storybook story
8. Include Playwright tests
9. **Preserve working behavior** — don't break existing UX when refactoring

## Code Style

- SCSS starts with Figma URL: `// Figma: https://figma.com/design/...`
- No decorative comment dividers
- No verbose headers
- No emojis in code or console output

## File Structure

```
src/components/{Name}/
├── parts.tsx
├── {Name}.module.scss
├── {Name}.test.tsx
├── {Name}.stories.tsx
└── index.ts
```

## Test Matrix

Derive tests from Base UI props — if a prop exists, test both states:

| Prop Type | Test |
|-----------|------|
| `multiple` | Single closes others, multiple keeps open |
| `disabled` | Cannot interact, not focusable |
| `value`/`onChange` | Controlled mode |
| `defaultValue` | Uncontrolled initial state |
| Keyboard | Enter, Space, Arrow keys, Home, End |

## Checklist

- [ ] Figma CSS fetched (MCP or `npm run figma:node`)
- [ ] Tokens used where they exist
- [ ] forwardRef + clsx
- [ ] Reduced motion handled
- [ ] Test matrix covered (all behavioral props)
- [ ] Build passes (`npm run build`)
- [ ] Tests pass (`npm test`)
